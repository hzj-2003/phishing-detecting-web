<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <!-- 头部元信息保持不变 -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>互联网钓鱼攻击检测系统</title>
    <style>
        /* 所有样式保持不变 */
        body { margin: 0; font-family: Arial, sans-serif; }
        /* ...原有样式... */
    </style>
</head>
<body>
    <!-- HTML结构保持不变 -->
    <div class="navbar">...</div>

    <div class="main-content">
        <div class="detection-container">
            <!-- 输入部分保持不变 -->
            <div class="input-section">...</div>
            
            <!-- 结果展示部分 -->
            <div id="resultCard">
                <div class="result-header">...</div>
                <div class="result-details">
                    <div>检测结果: <span class="status-text"></span></div>
                    <div>可信概率: <span class="confidence"></span></div>
                    <div>处理耗时: <span class="processing-time"></span>秒</div>
                    <div>检测时间: <span class="timestamp"></span></div>
                </div>
            </div>
            <div id="errorBox"></div>
        </div>
    </div>

    <div class="footer">...</div>

    <script>
        // ================== API配置 ==================
        const API_ENDPOINT = 'https://your-ngrok-url.ngrok-free.app/detect';

        // ================== 核心检测逻辑 ==================
        async function startDetection() {
            // ...变量定义与状态重置代码保持不变...

            try {
                // ...输入验证代码保持不变...

                // 调用API（关键修改）
                const response = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url: urlInput.value.trim() }),
                    signal: controller.signal
                });

                // ...错误处理代码保持不变...

                // 数据解析（严格校验）
                const responseData = await response.json();
                validateApiResponse(responseData); // 新增校验
                const formattedData = formatResult(responseData);
                
                updateResultUI(formattedData);
                resultCard.style.display = 'block';

            } catch (error) {
                showError(error.message);
            } finally {
                resetButton();
            }
        }

        // ================== 新增数据校验函数 ==================
        function validateApiResponse(data) {
            const requiredFields = ['result', 'probability', 'processing_time'];
            requiredFields.forEach(field => {
                if (!(field in data)) throw new Error(`缺少字段: ${field}`);
            });
            if (typeof data.probability !== 'number' || 
                typeof data.processing_time !== 'number') {
                throw new Error('数据类型错误');
            }
        }

        // ================== 数据格式化函数 ==================
        function formatResult(data) {
            return {
                url: document.getElementById('urlInput').value.trim(),
                result: data.result === 'safe' ? '安全链接' : '恶意网站',
                confidence: `${(data.probability * 100).toFixed(1)}%`,
                processing_time: data.processing_time.toFixed(2),
                timestamp: new Date().toLocaleString('zh-CN', { 
                    timeZone: 'Asia/Shanghai' 
                })
            };
        }

        // ...其余辅助函数保持不变...
    </script>
</body>
</html>
